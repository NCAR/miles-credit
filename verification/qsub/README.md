# QSUB Scripts – Forecast Verification  
**Directory:** `./verification/qsub`  

This folder contains automatically generated qsub scripts that submit jobs to the cluster queue. These scripts handle different stages of forecast data gathering, verification, and metric calculation.  

### Purpose  
The scripts in this folder are designed to:  
- **Gather** forecast model output for processing.  
- **Calculate** key verification metrics (e.g., RMSE and ACC).  
- **Submit** jobs to the HPC queue in a parallelized manner to optimize computational efficiency.  

---

## QSUB Workflow  

### 1. Script Types  
- **`step00_gather_ForecastModel_all.sh`** – Gathers forecast data.  
- **`step02_RMSE_MF_all.sh`** – Runs RMSE calculations.  
- **`step02_ACC_MF_all.sh`** – Runs ACC calculations.  

**Important:** The gather step (`step00`) must complete successfully before submitting RMSE and ACC jobs.  

---

### 2. Running the Scripts  

1. **Submit Gather Scripts:**  
   ```bash
   bash step00_gather_ForecastModel_all.sh
   ```  
   This step processes and saves forecast model data.  

2. **Submit Verification Scripts (After Gather Completes):**  
   ```bash
   bash step02_RMSE_MF_all.sh
   bash step02_ACC_MF_all.sh
   ```  
   These scripts compute verification metrics for the gathered forecasts.  

---

### 3. Monitoring Progress  

- **Job Status:**  
   Use standard cluster job monitoring commands to track submitted jobs:  
   ```bash
   qstat -u <username>
   ```  
- **Error Logs:**  
   If jobs fail, check the `.err` files in this directory for logs. For example:  
   ```bash
   cat verif_ACC_MF.err
   ```  

---

## Expected Output  

- **NetCDF files** containing forecast data and metrics will be saved to the locations specified in the YAML config.  
- Results are categorized by forecast type (e.g., ACC or RMSE).  

---

## Tips & Troubleshooting  

- **Ensure the directory exists** for output files (`save_loc_verif` in YAML). Use:  
   ```python
   import os
   os.makedirs(path_verif, exist_ok=True)
   ```  
- **Re-run scripts** if files appear incomplete – already-processed files will be skipped.  
- **Cluster Load:** Large jobs may queue for extended periods. If necessary, adjust resource requests (e.g., `mem` or `ncpus`) in the script templates.  

---

### Additional Notes  
- These scripts are auto-generated by Jupyter notebooks located in `./verification/verification/`.  
- For details on modifying or regenerating qsub scripts, refer to the main README or the notebooks in the parent directory.  

---  